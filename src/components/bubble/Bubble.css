/**
 * Bubble コンポーネントのスタイル
 * ガラスモーフィズム効果を適用したシャボン玉
 * 
 * Requirements: 1.1, 1.2
 */

.bubble {
  position: absolute;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transform: translate(-50%, -50%);
  transition:
    transform var(--transition-fast),
    box-shadow var(--transition-fast);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;

  /* GPU加速 */
  will-change: transform, opacity;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* ガラスモーフィズム効果のレイヤー */
.bubble-glass-layer {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: radial-gradient(
    ellipse at 30% 30%,
    rgba(255, 255, 255, 0.95) 0%,
    rgba(255, 255, 255, 0.6) 20%,
    var(--bubble-color, rgba(99, 102, 241, 0.6)) 40%,
    var(--bubble-color, rgba(99, 102, 241, 0.4)) 80%,
    rgba(255, 255, 255, 0.2) 100%
  );
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  /* フチ色をシャボン玉の色に合わせる（デフォルト） */
  border: 1.5px solid var(--bubble-border-color, rgba(255, 255, 255, 0.6));
  box-shadow:
    0 4px 10px rgba(0, 0, 0, 0.05),
    inset 0 1px 0 rgba(255, 255, 255, 0.2),
    0 0 20px rgba(255, 255, 255, 0.3);
}

/* ハイライト効果 */
.bubble-highlight {
  position: absolute;
  width: 30%;
  height: 30%;
  top: 15%;
  left: 20%;
  border-radius: 50%;
  background: radial-gradient(
    ellipse at center,
    rgba(255, 255, 255, 0.9) 0%,
    rgba(255, 255, 255, 0.4) 50%,
    transparent 100%
  );
  pointer-events: none;
}

/* コンテンツ */
.bubble-content {
  position: relative;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  padding: var(--spacing-xs);
  text-align: center;
  overflow: hidden;
}

.bubble-name {
  color: rgba(0, 0, 0, 0.75);
  font-family: 'M PLUS Rounded 1c', 'Noto Sans JP', sans-serif;
  font-weight: 500;
  font-size: 11px;
  line-height: 1.2;
  word-break: keep-all;
  overflow-wrap: break-word;
  max-width: 85%;
  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* タイプ別のカラーバリエーション（パステルカラー + 自然なフチ色） */
.bubble-type-song .bubble-glass-layer {
  --bubble-color: rgba(255, 182, 193, 0.6); /* パステルピンク */
  --bubble-border-color: rgba(255, 182, 193, 0.7); /* ピンク系フチ */
}

.bubble-type-lyricist .bubble-glass-layer {
  --bubble-color: rgba(135, 206, 235, 0.6); /* パステル水色 */
  --bubble-border-color: rgba(135, 206, 235, 0.7); /* 水色系フチ */
}

.bubble-type-composer .bubble-glass-layer {
  --bubble-color: rgba(221, 160, 221, 0.6); /* パステル紫 */
  --bubble-border-color: rgba(221, 160, 221, 0.7); /* 紫系フチ */
}

.bubble-type-arranger .bubble-glass-layer {
  --bubble-color: rgba(255, 250, 205, 0.7); /* パステル黄色 */
  --bubble-border-color: rgba(255, 230, 150, 0.7); /* 黄色系フチ */
}

.bubble-type-tag .bubble-glass-layer {
  --bubble-color: rgba(152, 251, 152, 0.6); /* パステル黄緑 */
  --bubble-border-color: rgba(152, 251, 152, 0.7); /* 黄緑系フチ */
}

/* ホバー効果（デスクトップのみ） */
@media (hover: hover) {
  .bubble:hover {
    transform: translate(-50%, -50%) scale(1.08);
    z-index: 10;
  }

  .bubble:hover .bubble-glass-layer {
    box-shadow:
      0 8px 20px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.3),
      0 0 30px rgba(255, 255, 255, 0.4);
  }
}

/* フォーカス状態 */
.bubble:focus {
  outline: none;
}

.bubble:focus-visible {
  transform: translate(-50%, -50%) scale(1.05);
  z-index: 10;
}

.bubble:focus-visible .bubble-glass-layer {
  border-color: var(--color-primary);
  box-shadow:
    0 0 0 3px var(--color-primary-alpha),
    0 4px 10px rgba(0, 0, 0, 0.1);
}

/* 選択状態 */
.bubble-selected {
  z-index: 20;
}

.bubble-selected .bubble-glass-layer {
  border: 2px dashed var(--color-secondary);
  animation: bubble-selection-pulse 1.5s ease-in-out infinite;
}

.bubble-selection-indicator {
  position: absolute;
  inset: -5px;
  border-radius: 50%;
  border: 2px dashed var(--color-secondary);
  animation: bubble-selection-rotate 4s linear infinite;
  pointer-events: none;
}

/* アクティブ状態（タップ時） */
.bubble:active {
  transform: translate(-50%, -50%) scale(0.95);
}

/* アニメーション */
@keyframes bubble-selection-pulse {
  0%,
  100% {
    box-shadow:
      0 0 0 0 rgba(236, 72, 153, 0.4),
      0 4px 10px rgba(0, 0, 0, 0.05);
  }
  50% {
    box-shadow:
      0 0 0 8px rgba(236, 72, 153, 0),
      0 4px 10px rgba(0, 0, 0, 0.05);
  }
}

@keyframes bubble-selection-rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

/* 浮遊アニメーション */
@keyframes bubble-float {
  0%,
  100% {
    transform: translate(-50%, -50%) translateY(0);
  }
  50% {
    transform: translate(-50%, -50%) translateY(-5px);
  }
}

.bubble {
  animation: bubble-float 3s ease-in-out infinite;
}

/* パフォーマンス最適化: 一時停止時 */
.bubble[style*='paused'] {
  animation-play-state: paused;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
  .bubble-name {
    font-size: 0.85em;
  }

  /* タッチデバイスでのタップ領域を拡大 */
  .bubble::before {
    content: '';
    position: absolute;
    inset: -10px;
    border-radius: 50%;
  }
}

/* 小さいシャボン玉の場合はテキストを非表示 */
.bubble[style*='width: 3'][style*='px'] .bubble-name,
.bubble[style*='width: 4'][style*='px'] .bubble-name {
  display: none;
}

/* アクセシビリティ: 動きを減らす設定 */
@media (prefers-reduced-motion: reduce) {
  .bubble {
    animation: none;
  }

  .bubble-selection-indicator {
    animation: none;
  }

  .bubble-selected .bubble-glass-layer {
    animation: none;
  }
}

/* ===== 栗林みな実専用：栗の形 ===== */
.bubble-chestnut {
  /* clip-pathで栗の形を作成: 上が尖り、下が丸い（滑らかなカーブ） */
  clip-path: polygon(
    50% 0%,
    35% 8%,
    22% 18%,
    12% 32%,
    5% 48%,
    2% 62%,
    3% 75%,
    8% 85%,
    18% 93%,
    32% 98%,
    50% 100%,
    68% 98%,
    82% 93%,
    92% 85%,
    97% 75%,
    98% 62%,
    95% 48%,
    88% 32%,
    78% 18%,
    65% 8%
  );
  border-radius: 0;
  animation: chestnut-float 3s ease-in-out infinite;
}

.bubble-chestnut .bubble-glass-layer {
  /* 栗の形に合わせる */
  clip-path: polygon(
    50% 0%,
    35% 8%,
    22% 18%,
    12% 32%,
    5% 48%,
    2% 62%,
    3% 75%,
    8% 85%,
    18% 93%,
    32% 98%,
    50% 100%,
    68% 98%,
    82% 93%,
    92% 85%,
    97% 75%,
    98% 62%,
    95% 48%,
    88% 32%,
    78% 18%,
    65% 8%
  );
  border-radius: 0;
  /* 栗色のグラデーション */
  background: radial-gradient(
    ellipse at 30% 35%,
    rgba(255, 255, 255, 0.9) 0%,
    rgba(255, 255, 255, 0.5) 15%,
    rgba(165, 110, 60, 0.7) 35%,
    rgba(120, 75, 40, 0.8) 70%,
    rgba(90, 55, 25, 0.6) 100%
  );
  border: none;
  --bubble-border-color: rgba(101, 67, 33, 0.8);
}

.bubble-chestnut .bubble-highlight {
  /* ハイライトを栗の形に合わせて調整 */
  top: 22%;
  left: 22%;
  width: 28%;
  height: 28%;
}

/* 栗の座（底のザラザラした部分） */
.bubble-chestnut-base {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 55%;
  height: 12%;
  background: linear-gradient(
    to top,
    rgba(200, 180, 150, 0.95) 0%,
    rgba(180, 160, 130, 0.9) 50%,
    rgba(160, 140, 110, 0.6) 80%,
    transparent 100%
  );
  border-radius: 0 0 45% 45% / 0 0 80% 80%;
  z-index: 2;
  pointer-events: none;
}

/* 座のザラザラ感を表現 */
.bubble-chestnut-base::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    90deg,
    transparent 0px,
    rgba(120, 100, 70, 0.4) 1px,
    transparent 2px,
    transparent 3px
  );
  border-radius: inherit;
}

/* 座の縁取り */
.bubble-chestnut-base::after {
  content: '';
  position: absolute;
  top: 0;
  left: 5%;
  right: 5%;
  height: 2px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(101, 67, 33, 0.5) 20%,
    rgba(101, 67, 33, 0.7) 50%,
    rgba(101, 67, 33, 0.5) 80%,
    transparent 100%
  );
  border-radius: 50%;
}

/* 栗の浮遊アニメーション（少し揺れる） */
@keyframes chestnut-float {
  0%,
  100% {
    transform: translate(-50%, -50%) translateY(0) rotate(-2deg);
  }
  25% {
    transform: translate(-50%, -50%) translateY(-3px) rotate(0deg);
  }
  50% {
    transform: translate(-50%, -50%) translateY(-5px) rotate(2deg);
  }
  75% {
    transform: translate(-50%, -50%) translateY(-3px) rotate(0deg);
  }
}

/* 栗のホバー効果 */
@media (hover: hover) {
  .bubble-chestnut:hover {
    transform: translate(-50%, -50%) scale(1.1) rotate(5deg);
  }
}

/* 栗の選択インジケーター */
.bubble-chestnut .bubble-selection-indicator {
  clip-path: polygon(
    50% 0%,
    35% 8%,
    22% 18%,
    12% 32%,
    5% 48%,
    2% 62%,
    3% 75%,
    8% 85%,
    18% 93%,
    32% 98%,
    50% 100%,
    68% 98%,
    82% 93%,
    92% 85%,
    97% 75%,
    98% 62%,
    95% 48%,
    88% 32%,
    78% 18%,
    65% 8%
  );
  border-radius: 0;
  inset: -6px;
}

/* アクセシビリティ: 動きを減らす設定（栗用） */
@media (prefers-reduced-motion: reduce) {
  .bubble-chestnut {
    animation: none;
  }
}
